# æ¤­åœ†å½¢å½¢æ€å­¦é˜ˆå€¼åˆ†å‰²ç®—æ³•

## ğŸ¯ ç®—æ³•æ¦‚è¿°

æ–°å¢çš„æ¤­åœ†å½¢å½¢æ€å­¦é˜ˆå€¼åˆ†å‰²ç®—æ³•æä¾›äº†ä¸€ä¸ªé«˜åº¦å¯é…ç½®çš„å›¾åƒåˆ†å‰²è§£å†³æ–¹æ¡ˆï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦ç²¾ç¡®æ§åˆ¶å½¢çŠ¶å’Œé˜ˆå€¼èŒƒå›´çš„åˆ†å‰²ä»»åŠ¡ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### 1. åŒé˜ˆå€¼é€‰æ‹©
- **é˜ˆå€¼ä¸‹é™æ»‘åŠ¨æ¡**: 0-255ï¼Œæ§åˆ¶åˆ†å‰²åŒºé—´çš„æœ€ä½å€¼
- **é˜ˆå€¼ä¸Šé™æ»‘åŠ¨æ¡**: 0-255ï¼Œæ§åˆ¶åˆ†å‰²åŒºé—´çš„æœ€é«˜å€¼
- **å®æ—¶é¢„è§ˆ**: æ»‘åŠ¨æ¡å˜åŒ–ç«‹å³åæ˜ åˆ°åˆ†å‰²ç»“æœ
- **å‚æ•°æ˜ å°„**: å‰ç«¯æ»‘åŠ¨æ¡å€¼ç›´æ¥ä¼ é€’ç»™åç«¯ç®—æ³•

### 2. æ¤­åœ†å½¢å½¢æ€å­¦æ£€æµ‹
- **æ¤­åœ†é•¿è½´æ§åˆ¶**: 3-50åƒç´ ï¼Œå¯è°ƒèŠ‚æ¤­åœ†æ ¸çš„å¤§å°
- **æ¤­åœ†çŸ­è½´æ§åˆ¶**: 3-50åƒç´ ï¼Œæ§åˆ¶æ¤­åœ†çš„å®½åº¦
- **æ—‹è½¬è§’åº¦æ§åˆ¶**: -180Â°åˆ°180Â°ï¼Œæ”¯æŒä»»æ„è§’åº¦çš„æ¤­åœ†
- **åŠ¨æ€æ¤­åœ†æ ¸**: æ ¹æ®ä¸¥æ ¼ç¨‹åº¦è‡ªåŠ¨è°ƒæ•´æ¤­åœ†å¤§å°

### 3. å½¢æ€å­¦ä¸¥æ ¼ç¨‹åº¦æ§åˆ¶
- **ç»Ÿä¸€å¼ºåº¦æ»‘åŠ¨æ¡**: 0.0ï¼ˆå®½æ¾ï¼‰-1.0ï¼ˆä¸¥æ ¼ï¼‰
- **è‡ªåŠ¨å‚æ•°æ˜ å°„**: å¼ºåº¦å€¼å½±å“æ‰€æœ‰å½¢æ€å­¦å‚æ•°
- **æ™ºèƒ½è°ƒæ•´**: æ ¹æ®ä¸¥æ ¼ç¨‹åº¦åŠ¨æ€è°ƒæ•´æ ¸å¤§å°å’Œè¿­ä»£æ¬¡æ•°

## ğŸ”§ æŠ€æœ¯å®ç°

### åç«¯ç®—æ³•æ¶æ„

#### æ ¸å¿ƒç±»: `EllipticalMorphSegmentor`

```python
class EllipticalMorphSegmentor:
    def segment(self, image, roi, parameters):
        # ç¬¬ä¸€æ­¥ï¼šé¢„å¤„ç†
        blurred = cv2.GaussianBlur(roi_img, (blur_ksize, blur_ksize), 0)
        clahe = cv2.createCLAHE(clipLimit=clahe_clip, tileGridSize=(clahe_tile, clahe_tile))
        enhanced = clahe.apply(blurred)

        # ç¬¬äºŒæ­¥ï¼šåŒé˜ˆå€¼åˆ†å‰²
        mask = np.zeros_like(roi_img, dtype=np.uint8)
        mask[(enhanced >= threshold_min) & (enhanced <= threshold_max)] = 255

        # ç¬¬ä¸‰æ­¥ï¼šæ¤­åœ†å½¢å½¢æ€å­¦æ“ä½œ
        kernel = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (major_axis, minor_axis))
        if angle != 0:
            kernel = self._create_rotated_ellipse_kernel(major_axis, minor_axis, angle)

        processed = cv2.morphologyEx(mask, cv2.MORPH_CLOSE, kernel, iterations=close_iter)
        processed = cv2.morphologyEx(processed, cv2.MORPH_OPEN, kernel, iterations=open_iter)
```

#### å…³é”®ç‰¹æ€§
1. **åŒé˜ˆå€¼å¤„ç†**: åœ¨æŒ‡å®šç°åº¦åŒºé—´å†…çš„åƒç´ è¢«ä¿ç•™
2. **æ¤­åœ†å½¢æ€å­¦**: ä½¿ç”¨æ¤­åœ†å½¢ç»“æ„å…ƒç´ è¿›è¡Œå¼€é—­è¿ç®—
3. **æ—‹è½¬æ”¯æŒ**: æ”¯æŒä»»æ„è§’åº¦çš„æ¤­åœ†å½¢æ ¸
4. **æ™ºèƒ½å‚æ•°**: æ ¹æ®ä¸¥æ ¼ç¨‹åº¦åŠ¨æ€è°ƒæ•´æ‰€æœ‰å‚æ•°
5. **æ¤­åœ†æ€§æ£€æŸ¥**: é«˜ä¸¥æ ¼åº¦ä¸‹éªŒè¯åŒºåŸŸæ¤­åœ†æ€§

### å‰ç«¯é›†æˆ

#### å‚æ•°ç±»å‹å®šä¹‰
```typescript
type EllipticalMorphParams = {
  thresholdMin: number;        // é˜ˆå€¼ä¸‹é™ (0-255)
  thresholdMax: number;        // é˜ˆå€¼ä¸Šé™ (0-255)
  ellipseMajorAxis: number;    // æ¤­åœ†é•¿è½´ (3-50)
  ellipseMinorAxis: number;    // æ¤­åœ†çŸ­è½´ (3-50)
  ellipseAngle: number;        // æ¤­åœ†æ—‹è½¬è§’åº¦ (-180-180)
  morphStrength: number;       // å½¢æ€å­¦ä¸¥æ ¼ç¨‹åº¦ (0-1)
  blurKernelSize: number;       // é¢„å¤„ç†æ¨¡ç³Šæ ¸å¤§å°
  claheClipLimit: number;      // CLAHEå¯¹æ¯”åº¦é™åˆ¶
  claheTileGridSize: number;   // CLAHEç½‘æ ¼å¤§å°
};
```

#### ç”¨æˆ·ç•Œé¢ç»„ä»¶
1. **é˜ˆå€¼åŒºé—´é€‰æ‹©**: ä¸¤ä¸ªç‹¬ç«‹çš„æ»‘åŠ¨æ¡æ§åˆ¶ä¸Šä¸‹é™
2. **æ¤­åœ†å½¢æ€å­¦æ§åˆ¶**: ç»Ÿä¸€çš„ä¸¥æ ¼ç¨‹åº¦æ»‘åŠ¨æ¡
3. **æ¤­åœ†å½¢çŠ¶å‚æ•°**: é•¿è½´ã€çŸ­è½´ã€æ—‹è½¬è§’åº¦çš„ç²¾ç¡®æ§åˆ¶
4. **é¢„å¤„ç†å‚æ•°**: æ¨¡ç³Šå’ŒCLAHEå‚æ•°è°ƒèŠ‚

## ğŸ“Š å‚æ•°æ˜ å°„è¡¨

### å½¢æ€å­¦ä¸¥æ ¼ç¨‹åº¦æ˜ å°„ (morph_strength)

| æ»‘åŠ¨æ¡å€¼ | æ¤­åœ†æ ¸ç¼©æ”¾ | é—­è¿ç®—æ¬¡æ•° | å¼€è¿ç®—æ¬¡æ•° | æœ€å°åŒºåŸŸé¢ç§¯ |
|----------|------------|------------|------------|--------------|
| 0.0      | 50%        | 1æ¬¡       | 0æ¬¡       | 250åƒç´       |
| 0.25     | 62%        | 2æ¬¡       | 1æ¬¡       | 200åƒç´       |
| 0.5      | 75%        | 2æ¬¡       | 2æ¬¡       | 150åƒç´       |
| 0.75     | 87%        | 3æ¬¡       | 2æ¬¡       | 100åƒç´       |
| 1.0      | 100%       | 4æ¬¡       | 3æ¬¡       | 50åƒç´        |

### æ¤­åœ†å½¢çŠ¶å‚æ•°å½±å“
- **é•¿è½´/çŸ­è½´æ¯”**: å†³å®šæ¤­åœ†çš„å½¢çŠ¶ï¼ˆåœ†å½¢åˆ°é•¿æ¡å½¢ï¼‰
- **æ—‹è½¬è§’åº¦**: é€‚åº”ä¸åŒæ–¹å‘çš„ç»“æ„ç‰¹å¾
- **æ ¸å¤§å°**: å½±å“å½¢æ€å­¦æ“ä½œçš„è¦†ç›–èŒƒå›´

## ğŸ® ä½¿ç”¨æŒ‡å—

### åŸºæœ¬æ“ä½œæµç¨‹

1. **é€‰æ‹©ç®—æ³•**: åœ¨æ¨¡å‹ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©"æ¤­åœ†å½¢æ€å­¦ Â· é˜ˆå€¼åˆ†å‰²"
2. **è°ƒèŠ‚é˜ˆå€¼åŒºé—´**: ä½¿ç”¨ä¸¤ä¸ªæ»‘åŠ¨æ¡è®¾ç½®ç°åº¦èŒƒå›´
3. **æ§åˆ¶æ¤­åœ†å½¢çŠ¶**: è°ƒæ•´é•¿è½´ã€çŸ­è½´å’Œæ—‹è½¬è§’åº¦
4. **è®¾ç½®ä¸¥æ ¼ç¨‹åº¦**: ä½¿ç”¨ç»Ÿä¸€æ»‘åŠ¨æ¡æ§åˆ¶å½¢æ€å­¦å¼ºåº¦
5. **å®æ—¶é¢„è§ˆ**: è§‚å¯Ÿå‚æ•°å˜åŒ–å¯¹åˆ†å‰²ç»“æœçš„å½±å“

### å‚æ•°è°ƒèŠ‚å»ºè®®

#### é˜ˆå€¼åŒºé—´è®¾ç½®
- **ä½å¯¹æ¯”åº¦å›¾åƒ**: æ‰©å¤§é˜ˆå€¼åŒºé—´ï¼Œå¢åŠ å®¹å·®
- **é«˜å¯¹æ¯”åº¦å›¾åƒ**: ç¼©å°é˜ˆå€¼åŒºé—´ï¼Œæé«˜ç²¾åº¦
- **ç‰¹å®šç›®æ ‡**: æ ¹æ®ç›®æ ‡ç°åº¦å€¼ç²¾ç¡®è®¾ç½®åŒºé—´

#### æ¤­åœ†å½¢çŠ¶è°ƒèŠ‚
- **åœ†å½¢ç›®æ ‡**: é•¿è½´=çŸ­è½´ï¼Œè§’åº¦=0Â°
- **æ¤­åœ†å½¢ç›®æ ‡**: æ ¹æ®ç›®æ ‡é•¿å®½æ¯”è®¾ç½®
- **å€¾æ–œç›®æ ‡**: è°ƒæ•´æ—‹è½¬è§’åº¦åŒ¹é…ç›®æ ‡æ–¹å‘

#### ä¸¥æ ¼ç¨‹åº¦æ§åˆ¶
- **å®½æ¾è®¾ç½® (0.0-0.3)**: é€‚ç”¨äºå™ªå£°è¾ƒå¤šçš„å›¾åƒ
- **ä¸­ç­‰è®¾ç½® (0.4-0.6)**: å¹³è¡¡ç²¾åº¦å’Œé²æ£’æ€§
- **ä¸¥æ ¼è®¾ç½® (0.7-1.0)**: é€‚ç”¨äºé«˜è´¨é‡å›¾åƒï¼Œè¿½æ±‚é«˜ç²¾åº¦

## ğŸ”„ ä¸å…¶ä»–ç®—æ³•çš„å¯¹æ¯”

| ç‰¹æ€§ | T1ä¸­å¿ƒé»‘åŒº | æ¤­åœ†å½¢æ€å­¦ | ä¼ ç»ŸCV | SAMUSæ·±åº¦å­¦ä¹  |
|------|------------|------------|---------|----------------|
| **é˜ˆå€¼æ§åˆ¶** | è‡ªåŠ¨Otsu | åŒé˜ˆå€¼æ»‘åŠ¨æ¡ | å›ºå®šé˜ˆå€¼ | æ·±åº¦å­¦ä¹  |
| **å½¢æ€å­¦å½¢çŠ¶** | åœ†å½¢ | æ¤­åœ†å½¢+æ—‹è½¬ | åœ†å½¢ | è‡ªåŠ¨å­¦ä¹  |
| **å‚æ•°æ§åˆ¶** | ä¸¥æ ¼ç¨‹åº¦æ»‘åŠ¨æ¡ | å®Œæ•´å‚æ•°é›† | æœ‰é™å‚æ•° | ç½‘ç»œå‚æ•° |
| **é€‚ç”¨åœºæ™¯** | ä¸­å¿ƒåœ†å½¢åŒºåŸŸ | æ¤­åœ†å½¢ç›®æ ‡ | é€šç”¨å½¢çŠ¶ | å¤æ‚åœºæ™¯ |
| **è®¡ç®—æ•ˆç‡** | å¿«é€Ÿ | ä¸­ç­‰ | å¿«é€Ÿ | æ…¢ (GPU) |

## ğŸ¯ å…¸å‹åº”ç”¨åœºæ™¯

### 1. åŒ»å­¦å›¾åƒåˆ†æ
- **å™¨å®˜åˆ†å‰²**: æ¤­åœ†å½¢å™¨å®˜çš„ç²¾ç¡®æå–
- **è¡€ç®¡æ£€æµ‹**: ä¸åŒæ–¹å‘çš„è¡€ç®¡ç»“æ„è¯†åˆ«
- **ç—…ç¶å®šä½**: ç‰¹å®šå½¢çŠ¶çš„ç—…ç¶åŒºåŸŸåˆ†å‰²

### 2. å·¥ä¸šæ£€æµ‹
- **é›¶ä»¶è¯†åˆ«**: æ¤­åœ†å½¢æˆ–åœ†å½¢é›¶ä»¶çš„å®šä½
- **è´¨é‡æ§åˆ¶**: è¡¨é¢ç¼ºé™·çš„å½¢çŠ¶åˆ†æ
- **æµ‹é‡åˆ†æ**: å°ºå¯¸å’Œå½¢çŠ¶å‚æ•°çš„æµ‹é‡

### 3. ç§‘å­¦ç ”ç©¶
- **ç»†èƒåˆ†æ**: ç»†èƒæ ¸æˆ–ç»†èƒè´¨çš„åˆ†å‰²
- **å¤©ä½“å›¾åƒ**: æ˜Ÿç³»æˆ–å¤©ä½“å½¢çŠ¶çš„æå–
- **ææ–™ç§‘å­¦**: æ™¶ä½“ç»“æ„æˆ–ç›¸ç•Œåˆ†æ

## ğŸš€ æ€§èƒ½ç‰¹ç‚¹

### ç®—æ³•ä¼˜åŠ¿
1. **ç²¾ç¡®æ§åˆ¶**: åŒé˜ˆå€¼æä¾›æ¯”å•é˜ˆå€¼æ›´ç²¾ç¡®çš„é€‰æ‹©
2. **å½¢çŠ¶é€‚é…**: æ¤­åœ†å½¢æ¯”åœ†å½¢æ›´è´´åˆå®é™…ç›®æ ‡
3. **å‚æ•°ä¸°å¯Œ**: æä¾›å…¨é¢çš„å‚æ•°è°ƒèŠ‚é€‰é¡¹
4. **å®æ—¶å“åº”**: å‚æ•°å˜åŒ–ç«‹å³åæ˜ åˆ°ç»“æœ
5. **æ™ºèƒ½æ˜ å°„**: ä¸¥æ ¼ç¨‹åº¦ç»Ÿä¸€æ§åˆ¶å¤šä¸ªå‚æ•°

### æ€§èƒ½æŒ‡æ ‡
- **å¤„ç†é€Ÿåº¦**: ä¸­ç­‰ï¼ˆæ¯”åŸºç¡€CVæ…¢ï¼Œæ¯”æ·±åº¦å­¦ä¹ å¿«ï¼‰
- **å†…å­˜ä½¿ç”¨**: ä½åˆ°ä¸­ç­‰ï¼ˆå–å†³äºå›¾åƒå’Œæ ¸å¤§å°ï¼‰
- **ç²¾åº¦**: é«˜ï¼ˆç²¾ç¡®çš„é˜ˆå€¼å’Œå½¢çŠ¶æ§åˆ¶ï¼‰
- **ç¨³å®šæ€§**: é«˜ï¼ˆé²æ£’çš„é”™è¯¯å¤„ç†å’Œfallbackï¼‰

## ğŸ”® æœªæ¥æ‰©å±•è®¡åˆ’

### çŸ­æœŸæ”¹è¿›
1. **GPUåŠ é€Ÿ**: åˆ©ç”¨CUDAåŠ é€Ÿå½¢æ€å­¦æ“ä½œ
2. **è‡ªé€‚åº”å‚æ•°**: æ ¹æ®å›¾åƒç‰¹å¾è‡ªåŠ¨æ¨èå‚æ•°
3. **æ‰¹é‡å¤„ç†**: æ”¯æŒå¤šå›¾åƒçš„æ‰¹é‡åˆ†å‰²
4. **ç»“æœä¼˜åŒ–**: åå¤„ç†ä¼˜åŒ–ç®—æ³•æ”¹å–„åˆ†å‰²è´¨é‡

### é•¿æœŸå‘å±•
1. **æœºå™¨å­¦ä¹ é›†æˆ**: ä½¿ç”¨MLä¼˜åŒ–å‚æ•°é€‰æ‹©
2. **3Dæ‰©å±•**: æ”¯æŒä¸‰ç»´ä½“ç§¯æ•°æ®çš„æ¤­åœ†å½¢æ€å­¦
3. **å¤šå°ºåº¦åˆ†æ**: å¤šå°ºåº¦çš„æ¤­åœ†å½¢æ£€æµ‹
4. **å®æ—¶è§†é¢‘**: å®æ—¶è§†é¢‘æµçš„æ¤­åœ†ç›®æ ‡è·Ÿè¸ª

## ğŸ“ æŠ€æœ¯ç¬”è®°

### ç®—æ³•æ ¸å¿ƒæ€æƒ³
è¯¥ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ç»“åˆç²¾ç¡®çš„é˜ˆå€¼é€‰æ‹©å’Œçµæ´»çš„å½¢æ€å­¦æ“ä½œï¼Œé€šè¿‡æ¤­åœ†å½¢ç»“æ„å…ƒç´ æ›´å¥½åœ°åŒ¹é…å®é™…ç›®æ ‡çš„å½¢çŠ¶ç‰¹å¾ã€‚

### åˆ›æ–°ç‚¹
1. **åŒé˜ˆå€¼åŒºé—´**: æ¯”å•é˜ˆå€¼æä¾›æ›´çµæ´»çš„ç°åº¦èŒƒå›´æ§åˆ¶
2. **å¯æ—‹è½¬æ¤­åœ†æ ¸**: æ”¯æŒä»»æ„æ–¹å‘çš„æ¤­åœ†å½¢å½¢æ€å­¦æ“ä½œ
3. **ç»Ÿä¸€ä¸¥æ ¼ç¨‹åº¦**: é€šè¿‡å•ä¸€æ»‘åŠ¨æ¡æ§åˆ¶å¤šä¸ªç›¸å…³å‚æ•°
4. **å®æ—¶å‚æ•°æ˜ å°„**: å‰åç«¯å‚æ•°å®æ—¶åŒæ­¥

### æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ
- **æ¤­åœ†æ ¸æ—‹è½¬**: ä½¿ç”¨ä»¿å°„å˜æ¢ç”Ÿæˆæ—‹è½¬çš„æ¤­åœ†ç»“æ„å…ƒç´ 
- **å‚æ•°è”åŠ¨**: è®¾è®¡æ™ºèƒ½æ˜ å°„è§„åˆ™é¿å…å‚æ•°å†²çª
- **æ€§èƒ½ä¼˜åŒ–**: åˆç†çš„æ ¸å¤§å°å’Œè¿­ä»£æ¬¡æ•°é™åˆ¶
- **ç”¨æˆ·ç•Œé¢**: ç›´è§‚çš„å‚æ•°ç»„ç»‡å’Œå®æ—¶åé¦ˆ

## ğŸ‰ æ€»ç»“

æ¤­åœ†å½¢å½¢æ€å­¦é˜ˆå€¼åˆ†å‰²ç®—æ³•æˆåŠŸå®ç°äº†ï¼š
- âœ… **åŒé˜ˆå€¼é€‰æ‹©**: çµæ´»çš„ç°åº¦åŒºé—´æ§åˆ¶
- âœ… **æ¤­åœ†å½¢æ€å­¦**: å¯è°ƒå½¢çŠ¶å’Œè§’åº¦çš„å½¢æ€å­¦æ“ä½œ
- âœ… **ä¸¥æ ¼ç¨‹åº¦æ§åˆ¶**: ç»Ÿä¸€çš„å‚æ•°å¼ºåº¦è°ƒèŠ‚
- âœ… **å®Œæ•´å‰ç«¯ç•Œé¢**: ç›´è§‚æ˜“ç”¨çš„å‚æ•°æ§åˆ¶é¢æ¿
- âœ… **å®æ—¶å“åº”**: å‚æ•°å˜åŒ–çš„å³æ—¶åé¦ˆ

è¿™ä¸ªç®—æ³•ä¸ºç”¨æˆ·æä¾›äº†ç²¾ç¡®æ§åˆ¶å›¾åƒåˆ†å‰²çš„å¼ºå¤§å·¥å…·ï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦ç‰¹å®šå½¢çŠ¶åŒ¹é…å’Œç²¾ç¡®é˜ˆå€¼æ§åˆ¶çš„åº”ç”¨åœºæ™¯ã€‚é€šè¿‡ä¸ç°æœ‰ç³»ç»Ÿçš„æ— ç¼é›†æˆï¼Œç”¨æˆ·å¯ä»¥è½»æ¾åœ°åœ¨å¤šç§ç®—æ³•é—´åˆ‡æ¢ï¼Œæ‰¾åˆ°æœ€é€‚åˆå…¶å…·ä½“éœ€æ±‚çš„è§£å†³æ–¹æ¡ˆã€‚