# ä½¿ç”¨è¯´æ˜æ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»é™è„‰æ£€æµ‹ç³»ç»Ÿçš„ä½¿ç”¨æ–¹æ³•ï¼ŒåŒ…æ‹¬Webç•Œé¢æ“ä½œã€APIè°ƒç”¨å’Œæœ€ä½³å®è·µã€‚

## ç›®å½•

- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [Webç•Œé¢ä½¿ç”¨](#webç•Œé¢ä½¿ç”¨)
- [APIæ¥å£ä½¿ç”¨](#apiæ¥å£ä½¿ç”¨)
- [è§†é¢‘å¤„ç†æµç¨‹](#è§†é¢‘å¤„ç†æµç¨‹)
- [æ£€æµ‹ç»“æœè§£è¯»](#æ£€æµ‹ç»“æœè§£è¯»)
- [ROIç®¡ç†](#roiç®¡ç†)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

## ç³»ç»Ÿæ¦‚è¿°

é™è„‰æ£€æµ‹ç³»ç»Ÿä¸»è¦åº”ç”¨äºåŒ»ç–—è¯Šæ–­ã€ç”Ÿç‰©è¯†åˆ«å’Œç ”ç©¶åˆ†æé¢†åŸŸã€‚ç³»ç»Ÿé€šè¿‡å…ˆè¿›çš„å›¾åƒå¤„ç†å’Œæœºå™¨å­¦ä¹ ç®—æ³•ï¼Œä»è§†é¢‘ä¸­è¯†åˆ«å’Œå®šä½é™è„‰ç»“æ„ã€‚

### é€‚ç”¨åœºæ™¯

- **åŒ»ç–—è¯Šæ–­**: é™è„‰ç–¾ç—…ç­›æŸ¥å’Œè¯Šæ–­è¾…åŠ©
- **ç”Ÿç‰©è¯†åˆ«**: é™è„‰æ¨¡å¼èº«ä»½è®¤è¯
- **å­¦æœ¯ç ”ç©¶**: é™è„‰ç»“æ„åˆ†æå’Œç ”ç©¶
- **åŸ¹è®­æ•™è‚²**: åŒ»å­¦æ•™å­¦å’Œæ¼”ç¤º

### æ”¯æŒçš„è§†é¢‘æ ¼å¼

| æ ¼å¼ | æ‰©å±•å | æœ€å¤§æ–‡ä»¶å¤§å° | æ¨èè®¾ç½® |
|------|--------|--------------|----------|
| MP4 | .mp4 | 500MB | H.264ç¼–ç ï¼Œ1080p |
| AVI | .avi | 500MB | æ— æŸå‹ç¼© |
| MOV | .mov | 500MB | é«˜è´¨é‡è®¾ç½® |
| MKV | .mkv | 500MB | H.264ç¼–ç  |

## Webç•Œé¢ä½¿ç”¨

### ç™»å½•ç³»ç»Ÿ

1. è®¿é—® http://localhost:3000
2. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
3. ç‚¹å‡»"ç™»å½•"æŒ‰é’®

> **æ³¨æ„**: é¦–æ¬¡ä½¿ç”¨éœ€è¦è”ç³»ç®¡ç†å‘˜åˆ›å»ºè´¦æˆ·

### ä¸»ç•Œé¢ä»‹ç»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¡¶éƒ¨å¯¼èˆªæ                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¾§è¾¹æ                     â”‚           ä¸»å·¥ä½œåŒº              â”‚
â”‚ - é¡¹ç›®åˆ—è¡¨                â”‚                                â”‚
â”‚ - è§†é¢‘ç®¡ç†                â”‚       å½“å‰æ“ä½œæ˜¾ç¤ºåŒºåŸŸ          â”‚
â”‚ - æ£€æµ‹ç»“æœ                â”‚                                â”‚
â”‚ - ç³»ç»Ÿè®¾ç½®                â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è§†é¢‘ä¸Šä¼ 

#### æ­¥éª¤1: å‡†å¤‡è§†é¢‘æ–‡ä»¶

- ç¡®ä¿è§†é¢‘æ ¼å¼ä¸ºæ”¯æŒçš„æ ¼å¼ï¼ˆMP4, AVI, MOV, MKVï¼‰
- æ–‡ä»¶å¤§å°ä¸è¶…è¿‡500MB
- å»ºè®®è§†é¢‘é•¿åº¦2-5åˆ†é’Ÿï¼Œå¸§ç‡30fps
- æ‹æ‘„æ—¶ä¿æŒæ‰‹éƒ¨ç¨³å®šï¼Œå…‰çº¿å‡åŒ€

#### æ­¥éª¤2: ä¸Šä¼ æ“ä½œ

1. ç‚¹å‡»ä¾§è¾¹æ "è§†é¢‘ç®¡ç†"
2. ç‚¹å‡»"ä¸Šä¼ è§†é¢‘"æŒ‰é’®
3. é€‰æ‹©è§†é¢‘æ–‡ä»¶
4. å¡«å†™è§†é¢‘ä¿¡æ¯ï¼š
   - **æ‚£è€…ID**: å¯é€‰ï¼Œç”¨äºæ ‡è¯†æ‚£è€…
   - **è§†é¢‘æè¿°**: æè¿°æ‹æ‘„éƒ¨ä½å’Œç›®çš„
   - **æ‹æ‘„å‚æ•°**: å¯é€‰ï¼Œè®°å½•æ‹æ‘„æ¡ä»¶
5. ç‚¹å‡»"ä¸Šä¼ "å¼€å§‹å¤„ç†

#### æ­¥éª¤3: ä¸Šä¼ è¿›åº¦ç›‘æ§

```
ä¸Šä¼ è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 80%
çŠ¶æ€: æ­£åœ¨æå–å¸§...
é¢„è®¡å‰©ä½™æ—¶é—´: 30ç§’
```

#### ä¸Šä¼ æˆåŠŸæç¤º

```
âœ… è§†é¢‘ä¸Šä¼ æˆåŠŸ
ğŸ“¹ è§†é¢‘ID: video_20231118_001
â±ï¸ æ—¶é•¿: 2åˆ†30ç§’
ğŸï¸ æ€»å¸§æ•°: 4500å¸§
ğŸ“Š æ–‡ä»¶å¤§å°: 245MB
```

### è§†é¢‘æµè§ˆ

#### è§†é¢‘åˆ—è¡¨

| è§†é¢‘ID | æ–‡ä»¶å | æ‚£è€…ID | æ—¶é•¿ | çŠ¶æ€ | ä¸Šä¼ æ—¶é—´ | æ“ä½œ |
|--------|--------|--------|------|------|----------|------|
| video_001 | hand_vein.mp4 | P001 | 2:30 | å·²å¤„ç† | 2025-11-18 | æŸ¥çœ‹/åˆ é™¤ |
| video_002 | arm_vein.avi | P002 | 1:45 | å¤„ç†ä¸­ | 2025-11-18 | å–æ¶ˆ |
| video_003 | wrist_scan.mov | - | 3:15 | å¤±è´¥ | 2025-11-17 | é‡è¯• |

#### è§†é¢‘è¯¦æƒ…

1. ç‚¹å‡»è§†é¢‘è®°å½•è¿›å…¥è¯¦æƒ…é¡µ
2. æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯ï¼š
   - è§†é¢‘å±æ€§ï¼ˆåˆ†è¾¨ç‡ã€å¸§ç‡ã€ç¼–ç æ ¼å¼ï¼‰
   - å­˜å‚¨è·¯å¾„
   - å¤„ç†çŠ¶æ€
   - ç»Ÿè®¡ä¿¡æ¯

### å¸§æŸ¥çœ‹å™¨

#### å¸§å¯¼èˆª

```
å¸§å·: [0] [30] [60] [90] ...
     â†“
å½“å‰å¸§: ç¬¬60å¸§ (æ—¶é—´æˆ³: 2.0ç§’)
```

#### å¸§æ“ä½œ

- **æ’­æ”¾æ§åˆ¶**: æ’­æ”¾/æš‚åœ/åœæ­¢
- **å¸§è·³è½¬**: è·³è½¬åˆ°æŒ‡å®šå¸§å·
- **ç¼©æ”¾**: æ”¾å¤§/ç¼©å°æŸ¥çœ‹ç»†èŠ‚
- **å¯¹æ¯”**: å¹¶æ’å¯¹æ¯”å¤šä¸ªå¸§

#### å¸§ä¿¡æ¯æ˜¾ç¤º

- **åŸºæœ¬å±æ€§**: å¸§å·ã€æ—¶é—´æˆ³ã€åˆ†è¾¨ç‡
- **å›¾åƒç»Ÿè®¡**: äº®åº¦ã€å¯¹æ¯”åº¦ã€ç›´æ–¹å›¾
- **æ£€æµ‹ç»“æœ**: é™è„‰æ£€æµ‹æ ‡æ³¨ï¼ˆå¦‚æœå·²å¤„ç†ï¼‰

## APIæ¥å£ä½¿ç”¨

### ç¯å¢ƒå‡†å¤‡

#### 1. è·å–API Tokenï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
curl -X POST http://localhost:8000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "your_username", "password": "your_password"}'
```

è¿”å›Tokenï¼š
```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "token_type": "bearer"
```

#### 2. è®¾ç½®è®¤è¯

```bash
export API_TOKEN="your_access_token_here"
```

### å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹

#### Step 1: ä¸Šä¼ è§†é¢‘

```bash
# ä½¿ç”¨curlä¸Šä¼ 
curl -X POST http://localhost:8000/api/upload-video \
  -H "Authorization: Bearer $API_TOKEN" \
  -F "file=@/path/to/vein_video.mp4" \
  -F "patient_id=P001" \
  -F "description=å·¦æ‰‹é™è„‰æ£€æµ‹è§†é¢‘"

# è¿”å›ç»“æœ
{
  "success": true,
  "data": {
    "video_id": "video_20231118_001",
    "status": "uploaded",
    "upload_time": "2025-11-18T08:32:40Z"
  }
}
```

#### Step 2: è·å–è§†é¢‘ä¿¡æ¯

```bash
curl -X GET "http://localhost:8000/api/video/info/video_20231118_001" \
  -H "Authorization: Bearer $API_TOKEN"
```

#### Step 3: è·å–å¸§åˆ—è¡¨

```bash
curl -X GET "http://localhost:8000/api/frames/video_20231118_001?interval=30" \
  -H "Authorization: Bearer $API_TOKEN"
```

#### Step 4: å¼€å§‹æ£€æµ‹

```bash
# æäº¤æ£€æµ‹ä»»åŠ¡
curl -X POST http://localhost:8000/api/detect-vein \
  -H "Authorization: Bearer $API_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "video_id": "video_20231118_001",
    "frame_numbers": [0, 30, 60, 90],
    "algorithm": "advanced",
    "parameters": {
      "sensitivity": 0.8,
      "contrast_enhancement": true
    }
  }'
```

#### Step 5: è½®è¯¢æ£€æµ‹çŠ¶æ€

```bash
# æ£€æŸ¥ä»»åŠ¡çŠ¶æ€
curl -X GET "http://localhost:8000/api/task/status/detection_20231118_001" \
  -H "Authorization: Bearer $API_TOKEN"

# è½®è¯¢ç›´åˆ°å®Œæˆ
while true; do
  status=$(curl -s -X GET "http://localhost:8000/api/task/status/detection_20231118_001" \
    -H "Authorization: Bearer $API_TOKEN" | jq -r '.data.status')
  
  if [ "$status" = "completed" ]; then
    echo "æ£€æµ‹å®Œæˆ"
    break
  elif [ "$status" = "failed" ]; then
    echo "æ£€æµ‹å¤±è´¥"
    exit 1
  else
    echo "æ£€æµ‹è¿›è¡Œä¸­...çŠ¶æ€: $status"
    sleep 5
  fi
done
```

#### Step 6: è·å–æ£€æµ‹ç»“æœ

```bash
curl -X GET "http://localhost:8000/api/detection-results?video_id=video_20231118_001" \
  -H "Authorization: Bearer $API_TOKEN"
```

### Python SDKä½¿ç”¨ç¤ºä¾‹

```python
from vein_detection import VeinDetectionAPI
import time

# åˆå§‹åŒ–å®¢æˆ·ç«¯
api = VeinDetectionAPI(
    base_url="http://localhost:8000",
    token="your_access_token"
)

def main():
    try:
        # 1. ä¸Šä¼ è§†é¢‘
        print("1. ä¸Šä¼ è§†é¢‘...")
        video_id = api.upload_video(
            video_path="vein_video.mp4",
            patient_id="P001",
            description="å·¦æ‰‹é™è„‰æ£€æµ‹"
        )
        print(f"è§†é¢‘ä¸Šä¼ æˆåŠŸï¼ŒID: {video_id}")
        
        # 2. è·å–å¸§åˆ—è¡¨
        print("2. è·å–å¸§åˆ—è¡¨...")
        frames = api.get_frames(video_id, interval=30)
        frame_numbers = [f['frame_number'] for f in frames['data']['frames']]
        print(f"è·å–åˆ° {len(frame_numbers)} ä¸ªå…³é”®å¸§")
        
        # 3. å¼€å§‹æ£€æµ‹
        print("3. å¼€å§‹é™è„‰æ£€æµ‹...")
        task_id = api.detect_vein(
            video_id=video_id,
            frame_numbers=frame_numbers[:10],  # ä»…æ£€æµ‹å‰10å¸§ä½œä¸ºç¤ºä¾‹
            algorithm="advanced"
        )
        print(f"æ£€æµ‹ä»»åŠ¡å·²æäº¤ï¼Œä»»åŠ¡ID: {task_id}")
        
        # 4. ç­‰å¾…æ£€æµ‹å®Œæˆ
        print("4. ç­‰å¾…æ£€æµ‹å®Œæˆ...")
        while True:
            status = api.get_task_status(task_id)
            if status == "completed":
                print("âœ… æ£€æµ‹å®Œæˆ")
                break
            elif status == "failed":
                print("âŒ æ£€æµ‹å¤±è´¥")
                return
            else:
                print(f"ğŸ”„ æ£€æµ‹è¿›è¡Œä¸­... ({status})")
                time.sleep(5)
        
        # 5. è·å–ç»“æœ
        print("5. è·å–æ£€æµ‹ç»“æœ...")
        results = api.get_detection_results(video_id)
        
        # 6. è¾“å‡ºç»“æœæ‘˜è¦
        print("\n=== æ£€æµ‹ç»“æœæ‘˜è¦ ===")
        for frame_result in results['data']['frame_results']:
            frame_num = frame_result['frame_number']
            vein_points = frame_result['vein_detection']['vein_points']
            avg_confidence = frame_result['vein_detection']['avg_confidence']
            print(f"å¸§ {frame_num}: {vein_points} ä¸ªé™è„‰ç‚¹, å¹³å‡ç½®ä¿¡åº¦: {avg_confidence:.2f}")
        
    except Exception as e:
        print(f"é”™è¯¯: {e}")

if __name__ == "__main__":
    main()
```

### JavaScript/Node.jsä½¿ç”¨ç¤ºä¾‹

```javascript
const VeinDetectionAPI = require('vein-detection-sdk');

async function main() {
    const api = new VeinDetectionAPI({
        baseUrl: 'http://localhost:8000',
        token: 'your_access_token'
    });

    try {
        // 1. ä¸Šä¼ è§†é¢‘
        console.log('1. ä¸Šä¼ è§†é¢‘...');
        const uploadResult = await api.uploadVideo(
            './vein_video.mp4',
            'P001',
            'å·¦æ‰‹é™è„‰æ£€æµ‹'
        );
        const videoId = uploadResult.data.video_id;
        console.log(`è§†é¢‘ä¸Šä¼ æˆåŠŸï¼ŒID: ${videoId}`);

        // 2. è·å–å¸§åˆ—è¡¨
        console.log('2. è·å–å¸§åˆ—è¡¨...');
        const frames = await api.getFrames(videoId, { interval: 30 });
        const frameNumbers = frames.data.frames.map(f => f.frame_number);
        console.log(`è·å–åˆ° ${frameNumbers.length} ä¸ªå…³é”®å¸§`);

        // 3. å¼€å§‹æ£€æµ‹
        console.log('3. å¼€å§‹é™è„‰æ£€æµ‹...');
        const taskId = await api.detectVein({
            videoId,
            frameNumbers: frameNumbers.slice(0, 10), // ä»…æ£€æµ‹å‰10å¸§
            algorithm: 'advanced'
        });
        console.log(`æ£€æµ‹ä»»åŠ¡å·²æäº¤ï¼Œä»»åŠ¡ID: ${taskId}`);

        // 4. è½®è¯¢æ£€æµ‹çŠ¶æ€
        console.log('4. ç­‰å¾…æ£€æµ‹å®Œæˆ...');
        let status;
        do {
            status = await api.getTaskStatus(taskId);
            if (status === 'completed') {
                console.log('âœ… æ£€æµ‹å®Œæˆ');
                break;
            } else if (status === 'failed') {
                console.log('âŒ æ£€æµ‹å¤±è´¥');
                return;
            } else {
                console.log(`ğŸ”„ æ£€æµ‹è¿›è¡Œä¸­... (${status})`);
                await new Promise(resolve => setTimeout(resolve, 5000));
            }
        } while (true);

        // 5. è·å–ç»“æœ
        console.log('5. è·å–æ£€æµ‹ç»“æœ...');
        const results = await api.getDetectionResults(videoId);

        // 6. è¾“å‡ºç»“æœ
        console.log('\n=== æ£€æµ‹ç»“æœæ‘˜è¦ ===');
        results.data.frameResults.forEach(frameResult => {
            console.log(
                `å¸§ ${frameResult.frameNumber}: ` +
                `${frameResult.veinDetection.veinPoints} ä¸ªé™è„‰ç‚¹, ` +
                `å¹³å‡ç½®ä¿¡åº¦: ${frameResult.veinDetection.avgConfidence.toFixed(2)}`
            );
        });

    } catch (error) {
        console.error('é”™è¯¯:', error);
    }
}

main();
```

## è§†é¢‘å¤„ç†æµç¨‹

### 1. è§†é¢‘é¢„å¤„ç†

#### è´¨é‡æ£€æŸ¥

- **åˆ†è¾¨ç‡æ£€æŸ¥**: æœ€ä½720pï¼Œæ¨è1080p+
- **å¸§ç‡æ£€æŸ¥**: å»ºè®®30fpsï¼ŒèŒƒå›´20-60fps
- **æ—¶é•¿æ£€æŸ¥**: å»ºè®®2-5åˆ†é’Ÿ
- **å‹ç¼©è´¨é‡**: æ£€æŸ¥è§†é¢‘å‹ç¼©ç¨‹åº¦ï¼Œé¿å…è¿‡åº¦å‹ç¼©

#### æ ¼å¼è½¬æ¢ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
# ä½¿ç”¨FFmpegè½¬æ¢è§†é¢‘æ ¼å¼
ffmpeg -i input.avi -c:v libx264 -crf 23 -preset medium output.mp4

# è°ƒæ•´åˆ†è¾¨ç‡
ffmpeg -i input.mp4 -vf scale=1920:1080 output_1080p.mp4

# è°ƒæ•´å¸§ç‡
ffmpeg -i input.mp4 -r 30 output_30fps.mp4
```

### 2. å¸§æå–ç­–ç•¥

#### æ™ºèƒ½é‡‡æ ·

- **å‡åŒ€é‡‡æ ·**: æŒ‰å›ºå®šé—´éš”æå–å¸§
- **å…³é”®å¸§æ£€æµ‹**: åŸºäºå†…å®¹å˜åŒ–é€‰æ‹©é‡è¦å¸§
- **è¿åŠ¨æ£€æµ‹**: æ£€æµ‹å¤§å¹…è¿åŠ¨å˜åŒ–æ—¶çš„å¸§

#### å‚æ•°é…ç½®

```python
# é‡‡æ ·é…ç½®ç¤ºä¾‹
sampling_config = {
    "method": "intelligent",  # uniform, intelligent, motion
    "base_interval": 30,      # åŸºç¡€é—´éš”ï¼ˆ30å¸§=1ç§’ï¼‰
    "keyframe_threshold": 0.3, # å…³é”®å¸§é˜ˆå€¼
    "max_frames": 1000,       # æœ€å¤§å¸§æ•°é™åˆ¶
    "min_confidence": 0.8     # æœ€å°ç½®ä¿¡åº¦
}
```

### 3. é™è„‰æ£€æµ‹ç®—æ³•

#### æ£€æµ‹æµç¨‹

1. **å›¾åƒé¢„å¤„ç†**
   - å™ªå£°é™ä½
   - å¯¹æ¯”åº¦å¢å¼º
   - è¾¹ç¼˜é”åŒ–

2. **ç‰¹å¾æå–**
   - é™è„‰çº¹ç†åˆ†æ
   - è¡€ç®¡åˆ†å¸ƒæ¨¡å¼
   - æ·±åº¦ç‰¹å¾è®¡ç®—

3. **æ£€æµ‹ä¸å®šä½**
   - å€™é€‰åŒºåŸŸç”Ÿæˆ
   - ç½®ä¿¡åº¦è¯„ä¼°
   - éæå¤§å€¼æŠ‘åˆ¶

4. **åå¤„ç†**
   - è¿é€šæ€§åˆ†æ
   - å½¢æ€å­¦ä¼˜åŒ–
   - åŒºåŸŸåˆå¹¶

#### ç®—æ³•å‚æ•°è°ƒä¼˜

```python
# æ£€æµ‹å‚æ•°é…ç½®
detection_params = {
    "sensitivity": 0.8,           # æ£€æµ‹æ•æ„Ÿåº¦ (0.0-1.0)
    "min_vein_length": 10,        # æœ€å°é™è„‰é•¿åº¦ï¼ˆåƒç´ ï¼‰
    "max_vein_width": 5,          # æœ€å¤§é™è„‰å®½åº¦ï¼ˆåƒç´ ï¼‰
    "contrast_threshold": 0.3,    # å¯¹æ¯”åº¦é˜ˆå€¼
    "noise_tolerance": 0.2,       # å™ªå£°å®¹å¿åº¦
    "enable_smoothing": True,     # å¯ç”¨å¹³æ»‘å¤„ç†
    "enable_enhancement": True    # å¯ç”¨å¢å¼ºå¤„ç†
}
```

## æ£€æµ‹ç»“æœè§£è¯»

### ç»“æœæ•°æ®ç»“æ„

```json
{
  "frame_results": [
    {
      "frame_number": 0,
      "detection_status": "completed",
      "vein_detection": {
        "vein_points": 15,
        "confidence_distribution": {
          "high": 8,    # ç½®ä¿¡åº¦ > 0.8
          "medium": 5,  # ç½®ä¿¡åº¦ 0.5-0.8
          "low": 2      # ç½®ä¿¡åº¦ < 0.5
        },
        "analysis_metrics": {
          "vein_clarity": 0.87,        # é™è„‰æ¸…æ™°åº¦
          "contrast_ratio": 0.42,      # å¯¹æ¯”åº¦æ¯”ç‡
          "signal_noise_ratio": 15.2,  # ä¿¡å™ªæ¯”
          "uniformity_score": 0.73     # å‡åŒ€æ€§è¯„åˆ†
        }
      },
      "roi_data": {
        "active_rois": 3,
        "total_rois": 5,
        "coverage_ratio": 0.85
      }
    }
  ]
}
```

### æŒ‡æ ‡è¯´æ˜

#### ç½®ä¿¡åº¦ç­‰çº§

- **High (é«˜)**: > 0.8 - æ£€æµ‹ç»“æœéå¸¸å¯é 
- **Medium (ä¸­)**: 0.5-0.8 - æ£€æµ‹ç»“æœè¾ƒå¯é 
- **Low (ä½)**: < 0.5 - æ£€æµ‹ç»“æœä¸ç¡®å®š

#### åˆ†ææŒ‡æ ‡

| æŒ‡æ ‡ | èŒƒå›´ | è¯´æ˜ | æ¨èå€¼ |
|------|------|------|--------|
| Vein Clarity | 0-1 | é™è„‰æ¸…æ™°åº¦ | > 0.7 |
| Contrast Ratio | 0-1 | å¯¹æ¯”åº¦æ¯”ç‡ | > 0.3 |
| Signal Noise Ratio | 0-âˆ | ä¿¡å™ªæ¯” | > 10 |
| Uniformity Score | 0-1 | å‡åŒ€æ€§è¯„åˆ† | > 0.6 |

### ç»“æœå¯è§†åŒ–

#### æ ‡æ³¨å›¾åƒ

ç³»ç»Ÿä¼šç”Ÿæˆå¸¦æ ‡æ³¨çš„å›¾åƒï¼Œç”¨ä¸åŒé¢œè‰²æ ‡è¯†æ£€æµ‹ç»“æœï¼š

- **çº¢è‰²**: é«˜ç½®ä¿¡åº¦é™è„‰
- **æ©™è‰²**: ä¸­ç­‰ç½®ä¿¡åº¦é™è„‰  
- **é»„è‰²**: ä½ç½®ä¿¡åº¦é™è„‰
- **è“è‰²**: ROIåŒºåŸŸ
- **ç»¿è‰²**: å‚è€ƒç‚¹

#### ç»Ÿè®¡å›¾è¡¨

- **ç½®ä¿¡åº¦åˆ†å¸ƒå›¾**: æ˜¾ç¤ºå„ç½®ä¿¡åº¦ç­‰çº§çš„é™è„‰ç‚¹æ•°é‡
- **æ—¶é—´åºåˆ—å›¾**: å±•ç¤ºé™è„‰æ£€æµ‹éšæ—¶é—´çš„å˜åŒ–
- **çƒ­åŠ›å›¾**: æ˜¾ç¤ºé™è„‰å¯†åº¦åˆ†å¸ƒ
- **3Då¯è§†åŒ–**: ç«‹ä½“å±•ç¤ºé™è„‰ç»“æ„

## ROIç®¡ç†

### ROIç±»å‹

#### 1. é™è„‰åŒºåŸŸ (Vein Region)

```json
{
  "type": "vein_region",
  "purpose": "ä¸»è¦æ£€æµ‹åŒºåŸŸ",
  "priority": 1,
  "properties": {
    "vein_type": "radial_vein",
    "expected_clarity": "high",
    "detection_focus": "primary"
  }
}
```

#### 2. å‚è€ƒç‚¹ (Reference Point)

```json
{
  "type": "reference_point", 
  "purpose": "æ ¡å‡†å’Œå®šä½",
  "priority": 2,
  "properties": {
    "reference_type": "anatomical",
    "stability": "high"
  }
}
```

#### 3. æ’é™¤åŒºåŸŸ (Exclusion Area)

```json
{
  "type": "exclusion_area",
  "purpose": "é¿å…è¯¯æ£€æµ‹",
  "priority": 3,
  "properties": {
    "exclusion_reason": "motion_artifacts",
    "confidence_threshold": 0.9
  }
}
```

### ROIåˆ›å»ºæµç¨‹

#### æ‰‹åŠ¨åˆ›å»º

1. åœ¨å¸§æŸ¥çœ‹å™¨ä¸­é€‰æ‹©å¸§
2. ç‚¹å‡»"æ·»åŠ ROI"æŒ‰é’®
3. ç»˜åˆ¶ROIåŒºåŸŸ
4. é…ç½®ROIå±æ€§
5. ä¿å­˜ROIè®¾ç½®

#### è‡ªåŠ¨æ£€æµ‹

```python
# ä½¿ç”¨ç®—æ³•è‡ªåŠ¨æ£€æµ‹ROI
roi_detection_config = {
    "method": "auto_detect",
    "algorithm": "contour_analysis",
    "parameters": {
        "min_area": 1000,      # æœ€å°åŒºåŸŸé¢ç§¯
        "max_area": 50000,     # æœ€å¤§åŒºåŸŸé¢ç§¯
        "aspect_ratio": [0.5, 2.0], # çºµæ¨ªæ¯”èŒƒå›´
        "confidence_threshold": 0.7
    }
}
```

### ROIåº”ç”¨

#### æ£€æµ‹æ—¶åº”ç”¨ROI

```python
# æ£€æµ‹é…ç½®ä¸­åº”ç”¨ROI
detection_config = {
    "use_roi": True,
    "roi_strategy": "focus",    # focus, exclude, weight
    "roi_expansion": 10,        # ROIæ‰©å±•åƒç´ 
    "weight_multiplier": 1.5    # ROIå†…æƒé‡å€æ•°
}
```

#### ROIæ•ˆæœä¼˜åŒ–

- **focus**: ä¸“æ³¨äºROIå†…æ£€æµ‹
- **exclude**: æ’é™¤ROIå¤–æ£€æµ‹  
- **weight**: ROIå†…åŠ æƒæ£€æµ‹

## æœ€ä½³å®è·µ

### è§†é¢‘æ‹æ‘„å»ºè®®

#### æ‹æ‘„ç¯å¢ƒ

- **å…‰çº¿**: å……è¶³ä¸”å‡åŒ€çš„ç…§æ˜ï¼Œé¿å…å¼ºåå°„
- **èƒŒæ™¯**: çº¯è‰²èƒŒæ™¯ï¼Œå¯¹æ¯”æ˜æ˜¾
- **ç¨³å®š**: ä½¿ç”¨æ”¯æ¶å›ºå®šï¼Œé¿å…æŠ–åŠ¨
- **è·ç¦»**: ä¿æŒé€‚å½“è·ç¦»ï¼Œç¡®ä¿é™è„‰æ¸…æ™°å¯è§

#### æ‹æ‘„æŠ€å·§

```markdown
âœ… æ¨èåšæ³•:
- æ‰‹éƒ¨æ”¾æ¾ï¼Œè‡ªç„¶æ”¾ç½®
- ä»å¤šä¸ªè§’åº¦æ‹æ‘„
- ä¿æŒæ’å®šçš„å…‰çº¿
- é¿å…æ‰‹æŒ‡å‹è¿«
- æ‹æ‘„æ—¶é•¿2-5åˆ†é’Ÿ

âŒ é¿å…åšæ³•:
- æ‰‹éƒ¨è¿‡åº¦å‹è¿«
- å¼ºçƒˆçš„é˜´å½±
- èƒŒæ™¯æ‚ä¹±
- å¿«é€Ÿç§»åŠ¨
- è¿‡åº¦å‹ç¼©è§†é¢‘
```

### å‚æ•°è°ƒä¼˜æŒ‡å—

#### æ ¹æ®è§†é¢‘è´¨é‡è°ƒæ•´

**é«˜è´¨é‡è§†é¢‘** (æ¸…æ™°ã€å¯¹æ¯”åº¦é«˜):
```python
detection_params = {
    "sensitivity": 0.9,
    "min_vein_length": 8,
    "noise_tolerance": 0.1,
    "enable_smoothing": False
}
```

**ä¸­ç­‰è´¨é‡è§†é¢‘**:
```python
detection_params = {
    "sensitivity": 0.7,
    "min_vein_length": 12,
    "noise_tolerance": 0.3,
    "enable_smoothing": True
}
```

**ä½è´¨é‡è§†é¢‘** (æ¨¡ç³Šã€å¯¹æ¯”åº¦ä½):
```python
detection_params = {
    "sensitivity": 0.5,
    "min_vein_length": 15,
    "noise_tolerance": 0.4,
    "enable_enhancement": True,
    "enhancement_strength": 1.2
}
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### æ‰¹å¤„ç†ä¼˜åŒ–

```python
# åˆç†è®¾ç½®æ‰¹å¤„ç†å¤§å°
batch_config = {
    "batch_size": 8,        # æ ¹æ®GPUå†…å­˜è°ƒæ•´
    "max_concurrent": 4,    # å¹¶å‘ä»»åŠ¡æ•°
    "memory_limit": "8GB",  # å†…å­˜é™åˆ¶
    "timeout": 300          # ä»»åŠ¡è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
}
```

#### ç¼“å­˜ç­–ç•¥

```python
# å¯ç”¨å¤šå±‚ç¼“å­˜
cache_config = {
    "frame_cache": True,      # å¸§ç¼“å­˜
    "result_cache": True,     # ç»“æœç¼“å­˜
    "model_cache": True,      # æ¨¡å‹ç¼“å­˜
    "cache_size": "2GB",      # ç¼“å­˜å¤§å°
    "ttl": 3600              # ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
}
```

### é”™è¯¯å¤„ç†

#### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

**è§†é¢‘ä¸Šä¼ å¤±è´¥**
```bash
# æ£€æŸ¥æ–‡ä»¶å¤§å°
ls -lh video.mp4

# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping localhost:8000

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs -f api
```

**æ£€æµ‹å¤±è´¥**
```bash
# æ£€æŸ¥GPUçŠ¶æ€
nvidia-smi

# éªŒè¯æ¨¡å‹æ–‡ä»¶
ls -la /models/vein_detection.pth

# æŸ¥çœ‹æ£€æµ‹æ—¥å¿—
tail -f /var/log/detection.log
```

#### é‡è¯•ç­–ç•¥

```python
# è‡ªåŠ¨é‡è¯•é…ç½®
retry_config = {
    "max_retries": 3,
    "retry_delay": 5,        # é‡è¯•é—´éš”ï¼ˆç§’ï¼‰
    "backoff_factor": 2,     # é€€é¿å› å­
    "retry_on_errors": [
        "DETECTION_FAILED",
        "TIMEOUT", 
        "MEMORY_INSUFFICIENT"
    ]
}
```

## æ•…éšœæ’é™¤

### è¯Šæ–­å·¥å…·

#### ç³»ç»ŸçŠ¶æ€æ£€æŸ¥

```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
curl http://localhost:8000/health

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
psql -h localhost -U vein_user -d vein_detection -c "SELECT 1;"

# æ£€æŸ¥Redisè¿æ¥
redis-cli ping

# æ£€æŸ¥å­˜å‚¨ç©ºé—´
df -h /data
```

#### æ—¥å¿—åˆ†æ

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs -f --tail=100 api

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep -i error /var/log/vein_detection.log | tail -20

# æ€§èƒ½åˆ†ææ—¥å¿—
grep -i "processing_time" /var/log/vein_detection.log | tail -10
```

### æ€§èƒ½ç›‘æ§

#### å…³é”®æŒ‡æ ‡

- **APIå“åº”æ—¶é—´**: < 200ms
- **æ£€æµ‹é€Ÿåº¦**: < 3s/å¸§
- **å†…å­˜ä½¿ç”¨**: < 8GB
- **CPUä½¿ç”¨ç‡**: < 80%
- **GPUä½¿ç”¨ç‡**: < 90%

#### ç›‘æ§è„šæœ¬

```bash
#!/bin/bash
# æ€§èƒ½ç›‘æ§è„šæœ¬

echo "=== ç³»ç»Ÿæ€§èƒ½ç›‘æ§ ==="
echo "æ—¶é—´: $(date)"

# CPUä½¿ç”¨ç‡
echo "CPUä½¿ç”¨ç‡:"
top -bn1 | grep "Cpu(s)" | awk '{print $2}' | awk -F'%' '{print "User: " $1 "%, System: " $3 "%"}'

# å†…å­˜ä½¿ç”¨
echo "å†…å­˜ä½¿ç”¨:"
free -h | awk 'NR==2{printf "Total: %s, Used: %s (%.2f%%), Free: %s\n", $2,$3,$3*100/$2,$7}'

# GPUçŠ¶æ€
if command -v nvidia-smi &> /dev/null; then
    echo "GPUçŠ¶æ€:"
    nvidia-smi --query-gpu=name,temperature.gpu,utilization.gpu --format=csv,noheader,nounits
fi

# APIæœåŠ¡
echo "APIæœåŠ¡çŠ¶æ€:"
curl -s -o /dev/null -w "HTTPçŠ¶æ€: %{http_code}, å“åº”æ—¶é—´: %{time_total}s\n" http://localhost:8000/health
```

---

å¦‚éœ€æ›´å¤šå¸®åŠ©ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿæˆ–æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£ã€‚